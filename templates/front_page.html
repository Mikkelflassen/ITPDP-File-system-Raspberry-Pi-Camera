{% extends "base.html" %}

{% block head %}
{% endblock %}

{% block body %}
<div class="hero">
    <h1> Control page </h1>
    <div id="controls" style="width: 200px; display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 30px;">
        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
            <div>
                <form action="/direction/F" method="get"> <button type="submit"> Forward </button> </form>
            </div>
            <div style="display: flex; flex-direction: row; gap: 10px;">
                <div>
                <form action="/direction/L" method="get"> <button type="submit"> Left </button> </form>
            </div>
            <div>
                <form action="/direction/R" method="get"> <button type="submit"> Right </button> </form>
            </div>
            </div>
            <div>
                <form action="/direction/B" method="get"> <button type="submit"> Backwards </button> </form>
            </div>
        </div>
        <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
            <div>
                <form action="/direction/U" method="get"> <button type="submit"> Up </button> </form>
            </div>
            <div>
                <form action="/direction/D" method="get"> <button type="submit"> Down </button> </form>
            </div>
        </div>
    </div>
</div>
<!-- ====== RECORD SECTION ====================================== -->
<div style="margin-top:2rem;text-align:center">
    <button id="recBtn"
            style="font-size:1.5rem;width:120px;height:120px;border-radius:50%;
                   background:#d22;color:#fff;border:0;box-shadow:0 3px 8px #0004">
        ●
    </button>
    <p id="recMsg" style="margin:.8rem 0 0;font-weight:500"></p>
  </div>
  
  <script>
  (()=>{                        // IIFE so we don't leak vars
   const API  = location.origin + '/api';
   const btn  = document.getElementById('recBtn');
   const msg  = document.getElementById('recMsg');
  
   btn.onclick = async ()=>{
     btn.disabled = true; msg.textContent = "Recording…";
     try{
       const r = await fetch(API+'/record', {method:'POST'});
       if(!r.ok) throw new Error(await r.text());
       msg.textContent = "Uploaded! Opening gallery…";
       setTimeout(()=>location.href='/', 1200);          // go to gallery
     }catch(e){
       console.error(e);
       msg.textContent = "Failed: " + e.message;
       btn.disabled = false;
     }
   };
  })();
  </script>
  <!-- ============================================================ -->
  
{% endblock %}